import{_ as N}from"./login-zh-icon.d552541b.js";import{r as u,B as F,y as w,A as y,m as V,s as x,u as W,b as c,o as D,c as A,g as n,t as P,e as i,w as t,I as G,D as E,i as B,E as H}from"./index.8a7a668c.js";import{r as R,u as l}from"./school.25e40e0c.js";import{u as Y}from"./user.41340bc4.js";const X="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAAXNSR0IArs4c6QAAAXBJREFUKFN1kD9IAnEUx9/3zlMHKYeGtmizLXCMoECoodG2IEqrJdLSJXX4QWgNB6eQg3kRQYGgQVtLEE01FNRUWw21BREuddz9XpxlHFFvejw+3z88kGeE2AtqYScF4mUCCtbr06EQwu4iKBnmiAT6QTIGojEwHXxYtO8PKBkmOQlCi5kuVZaPKJbrbQWKzrZzbbW1UyHm3rtOQlRDWo82BShRAsVRKpsPuXRy0Fvnr93l/oVd10A4OLGeThy54n/hTnw4cEKMRn41Uf0TLpbNCwW8LBllArXyqWSlW+nbuX6XSy8MddR6LUI+9YxBW15Q6LU+v09tomTsNknFdm5l/twVCCF83t+6t2LFTCmSQxB6LeKqLNsZF9mll9+f+E5rWtweRSfeqMcZlGHpjxfWZp+7gs1KPcoSDSY5nV9dvOnA7mwYOzEFikHgFklcEXiKCMOwnblcduneZX7gr757Qa3XmQFogJhvrbfnY2//T8TCqQlkvmWrAAAAAElFTkSuQmCC",K=async o=>await R.post("https://api.ps.familyeducation.org.cn/v1/user/auth/phone",o),Z=async o=>await R.post("https://api.ps.familyeducation.org.cn/v1/user/auth/send",o),J=async o=>await R.post("https://api.ps.familyeducation.org.cn/v1/school/admin/my_list",o),g=u(60),C=u(!1),z=async o=>{await Z({phone:o})},$=async o=>{await z(o),C.value=!0;const p=setInterval(()=>{g.value--,g.value<=0&&(C.value=!1,g.value=0,clearTimeout(p))},1e3)};const q={class:"container-wrap flex"},Q={class:"logo_section"},ee=["src"],ne={class:"school-name"},se={class:"logo_name_wrap"},_e=n("h1",{class:"title-char"},"Hi\uFF0C\u4F60\u597D\uFF01",-1),oe={class:"title-char"},ae={class:"flex-center login-container-wrap"},ie={class:"login-wrap"},pe=n("h1",null,"\u767B\u5F55\u7BA1\u7406\u4E2D\u5FC3",-1),te={class:"flex item-wrap p"},re=n("div",{class:"icon-wrap flex-center"},[n("img",{class:"login-icon",src:N,alt:""})],-1),me={class:"flex item-wrap"},ce={class:"flex el-input-wrap"},de=n("div",{class:"icon-wrap flex-center"},[n("img",{class:"login-icon",src:X,alt:""})],-1),le={key:0,class:"send-code grey"},ge=B("\u767B\u5F55"),Pe={__name:"loginView",setup(o){const p=F();console.log("query",p.query);const r=u({});w(async()=>{p.query.domain&&await l().reqSchoolDomainGetAPI(p.query.domain),l().schoolDomainInfo.id&&(r.value=l().schoolDomainInfo)});const v=u({}),O=(a,e,_)=>{e===""?_(new Error("\u8BF7\u8F93\u5165\u624B\u673A\u53F7")):/^1((3[0-9])|(4[1579])|(5[0-9])|(6[6])|(7[0-9])|(8[0-9])|(9[0-9]))\d{8}$/.test(e)?_():_(new Error("\u624B\u673A\u53F7\u683C\u5F0F\u4E0D\u6B63\u786E"))},U=(a,e,_)=>{e===""?_(new Error("\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801")):_()},s=y({codeRef:"",phoneRef:""}),S=V();x(()=>{S.loginInfo.phone&&(s.phoneRef=S.loginInfo.phone)});const b=y({phoneRef:[{validator:O,trigger:"blur"}],codeRef:[{validator:U,trigger:"blur"}]}),k=a=>{!a||a.validate(e=>{if(e)console.log("submit!",s),T();else return console.log("error submit!"),!1})},T=async()=>{const a={phone:s.phoneRef,code:s.codeRef},e=await K(a);S.getLoginInfo(e.token,e.uid,s.phoneRef),await M()},L=W(),M=async()=>{const e=await J({});f(),!e||e.length<1?H.error("\u65E0\u6743\u9650"):L.push({path:"/"})},f=()=>{const a=Y(),e=l();e.saveSchoolInfoList();const _=e.getSchoolInfoList[0].id;e.saveSchoolInfo(_),a.saveSchoolUserInfo()};return(a,e)=>{const _=c("el-input"),d=c("el-form-item"),I=c("el-checkbox"),h=c("el-button"),j=c("el-form");return D(),A("div",{class:"root",style:G(`background-image: url(${r.value.bg_img||"/public/images/login_bg.png"})`)},[n("div",q,[n("div",Q,[n("img",{class:"logo-img",src:r.value.icon||"/public/images/school_logo.png",alt:""},null,8,ee),n("span",ne,P(r.value.name||"\u798F\u5EFA\u5E7F\u64AD\u7535\u89C6\u5927\u5B66"),1)]),n("div",se,[_e,n("h1",oe," \u6B22\u8FCE\u6765\u5230"+P(r.value.name||"\u798F\u5EFA\u5E7F\u64AD\u7535\u89C6\u5927\u5B66"),1)]),n("div",ae,[n("div",ie,[pe,i(j,{ref_key:"ruleFormRef",ref:v,model:s,"status-icon":"",rules:b,"label-width":"120px",class:"demo-ruleForm","label-position":"top",style:{width:"314px"}},{default:t(()=>[i(d,{"label-width":0,prop:"phoneRef",style:{width:"314px"}},{default:t(()=>[n("div",te,[re,i(_,{modelValue:s.phoneRef,"onUpdate:modelValue":e[0]||(e[0]=m=>s.phoneRef=m),type:"text",maxlength:11,resize:"none",clearable:"",autocomplete:"off",class:"el-input"},null,8,["modelValue"])])]),_:1}),i(d,{"label-width":0,prop:"codeRef",style:{width:"314px"}},{default:t(()=>[n("div",me,[n("div",ce,[de,i(_,{resize:"none",class:"el-input code",maxlength:"6",modelValue:s.codeRef,"onUpdate:modelValue":e[1]||(e[1]=m=>s.codeRef=m),type:"codeRefword"},null,8,["modelValue"])]),E(C)?(D(),A("div",le," \u5DF2\u53D1\u9001("+P(E(g))+"s) ",1)):(D(),A("div",{key:1,class:"send-code",onClick:e[2]||(e[2]=m=>E($)(s.phoneRef))}," \u83B7\u53D6\u9A8C\u8BC1\u7801 "))])]),_:1}),i(d,null,{default:t(()=>[i(I,{label:"\u8BB0\u4F4F\u8D26\u53F7",name:"type"})]),_:1}),i(d,null,{default:t(()=>[i(h,{class:"login-btn",type:"primary",onClick:e[3]||(e[3]=m=>k(v.value))},{default:t(()=>[ge]),_:1})]),_:1})]),_:1},8,["model","rules"])])])])],4)}}};export{Pe as default};

import{_ as W}from"./login-zh-icon.d552541b.js";import{b as u,H as w,z as x,U as O,m as V,v as q,u as G,r as d,o as C,c as D,h as n,B as g,t as v,a,w as c,P as j,i as K,E as H}from"./index.a5417fcb.js";import{u as t}from"./school.3ccd3a33.js";import{u as B}from"./user.9f06caab.js";import{r as R}from"./request.905e5acc.js";import{g as T}from"./ak.cc808f0c.js";const X="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAAXNSR0IArs4c6QAAAXBJREFUKFN1kD9IAnEUx9/3zlMHKYeGtmizLXCMoECoodG2IEqrJdLSJXX4QWgNB6eQg3kRQYGgQVtLEE01FNRUWw21BREuddz9XpxlHFFvejw+3z88kGeE2AtqYScF4mUCCtbr06EQwu4iKBnmiAT6QTIGojEwHXxYtO8PKBkmOQlCi5kuVZaPKJbrbQWKzrZzbbW1UyHm3rtOQlRDWo82BShRAsVRKpsPuXRy0Fvnr93l/oVd10A4OLGeThy54n/hTnw4cEKMRn41Uf0TLpbNCwW8LBllArXyqWSlW+nbuX6XSy8MddR6LUI+9YxBW15Q6LU+v09tomTsNknFdm5l/twVCCF83t+6t2LFTCmSQxB6LeKqLNsZF9mll9+f+E5rWtweRSfeqMcZlGHpjxfWZp+7gs1KPcoSDSY5nV9dvOnA7mwYOzEFikHgFklcEXiKCMOwnblcduneZX7gr757Qa3XmQFogJhvrbfnY2//T8TCqQlkvmWrAAAAAElFTkSuQmCC",Y=async _=>await R.post("https://api.ps.familyeducation.org.cn/v1/user/auth/phone",_),Q=async _=>await R.post("https://api.ps.familyeducation.org.cn/v1/user/auth/send",_),z=async _=>await R.post("https://api.ps.familyeducation.org.cn/v1/school/admin/my_list",_),P=u(60),E=u(!1),J=async _=>{await Q({phone:_})},$=async _=>{await J(_),E.value=!0;const p=setInterval(()=>{P.value--,P.value<=0&&(E.value=!1,P.value=0,clearTimeout(p))},1e3)};const Z={class:"container-wrap flex"},ee={class:"logo_section"},ne=["src"],se={class:"school-name"},oe={class:"logo_name_wrap"},_e=n("h1",{class:"title-char"},"Hi\uFF0C\u4F60\u597D\uFF01",-1),ie={class:"title-char"},ae={class:"flex-center login-container-wrap"},pe={class:"login-wrap"},re=n("h1",null,"\u767B\u5F55\u5B66\u6821\u7BA1\u7406\u4E2D\u5FC3",-1),te={class:"flex item-wrap p"},me=n("div",{class:"icon-wrap flex-center"},[n("img",{class:"login-icon",src:W,alt:""})],-1),ce={class:"flex item-wrap"},le={class:"flex el-input-wrap"},de=n("div",{class:"icon-wrap flex-center"},[n("img",{class:"login-icon",src:X,alt:""})],-1),ge={key:0,class:"send-code grey"},Pe=K("\u767B\u5F55"),Re={__name:"loginView",setup(_){const p=w();console.log("query",p.query);const m=u({});x(async()=>{p.query.domain?await t().reqSchoolDomainGetAPI(p.query.domain):p.query.id&&await t().saveSchoolInfo(p.query.id),t().schoolDomainInfo.id?m.value=t().schoolDomainInfo:t().schoolInfo.id&&(m.value=t().schoolInfo)});const A=u({}),I=(i,e,s)=>{e===""?s(new Error("\u8BF7\u8F93\u5165\u624B\u673A\u53F7")):/^1((3[0-9])|(4[1579])|(5[0-9])|(6[6])|(7[0-9])|(8[0-9])|(9[0-9]))\d{8}$/.test(e)?s():s(new Error("\u624B\u673A\u53F7\u683C\u5F0F\u4E0D\u6B63\u786E"))},b=(i,e,s)=>{e===""?s(new Error("\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801")):s()},o=O({codeRef:"",phoneRef:""}),S=V();q(()=>{S.loginInfo.phone&&(o.phoneRef=S.loginInfo.phone)});const f=O({phoneRef:[{validator:I,trigger:"blur"}],codeRef:[{validator:b,trigger:"blur"}]}),k=i=>{!i||i.validate(e=>{if(e)console.log("submit!",o),F();else return console.log("error submit!"),!1})},F=async()=>{const i={phone:o.phoneRef,code:o.codeRef},e=await Y(i);S.getLoginInfo(e.token,e.uid,o.phoneRef),await N()},y=G(),N=async()=>{const e=await z({});!e||e.length<1?H.error("\u65E0\u6743\u9650"):(h(e),y.push({path:"/platformSelection"}))},h=i=>{const e=B(),s=t();s.saveSchoolInfoList();const r=i[0].school_id;console.log("debug :>> ",r),s.saveSchoolInfo(r),e.saveSchoolUserInfo()};return(i,e)=>{const s=d("el-input"),r=d("el-form-item"),M=d("el-checkbox"),U=d("el-button"),L=d("el-form");return C(),D("div",{class:"root",style:j(`background-image: url(${m.value.bg_img||g(T)("login_bg.png")})`)},[n("div",Z,[n("div",ee,[n("img",{class:"logo-img",src:m.value.icon||g(T)("school_logo.png"),alt:""},null,8,ne),n("span",se,v(m.value.name||"\u798F\u5EFA\u5F00\u653E\u5927\u5B66"),1)]),n("div",oe,[_e,n("h1",ie," \u6B22\u8FCE\u6765\u5230"+v(m.value.name||"\u798F\u5EFA\u5F00\u653E\u5927\u5B66"),1)]),n("div",ae,[n("div",pe,[re,a(L,{ref_key:"ruleFormRef",ref:A,model:o,"status-icon":"",rules:f,"label-width":"120px",class:"demo-ruleForm","label-position":"top",style:{width:"314px"}},{default:c(()=>[a(r,{"label-width":0,prop:"phoneRef",style:{width:"314px"}},{default:c(()=>[n("div",te,[me,a(s,{modelValue:o.phoneRef,"onUpdate:modelValue":e[0]||(e[0]=l=>o.phoneRef=l),type:"text",maxlength:11,resize:"none",clearable:"",autocomplete:"off",class:"el-input"},null,8,["modelValue"])])]),_:1}),a(r,{"label-width":0,prop:"codeRef",style:{width:"314px"}},{default:c(()=>[n("div",ce,[n("div",le,[de,a(s,{resize:"none",class:"el-input code",maxlength:"6",modelValue:o.codeRef,"onUpdate:modelValue":e[1]||(e[1]=l=>o.codeRef=l),type:"codeRefword"},null,8,["modelValue"])]),g(E)?(C(),D("div",ge," \u5DF2\u53D1\u9001("+v(g(P))+"s) ",1)):(C(),D("div",{key:1,class:"send-code",onClick:e[2]||(e[2]=l=>g($)(o.phoneRef))}," \u83B7\u53D6\u9A8C\u8BC1\u7801 "))])]),_:1}),a(r,null,{default:c(()=>[a(M,{label:"\u8BB0\u4F4F\u8D26\u53F7",name:"type"})]),_:1}),a(r,null,{default:c(()=>[a(U,{class:"login-btn",type:"primary",onClick:e[3]||(e[3]=l=>k(A.value))},{default:c(()=>[Pe]),_:1})]),_:1})]),_:1},8,["model","rules"])])])])],4)}}};export{Re as default};

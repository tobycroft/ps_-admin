import{_ as M}from"./login-zh-icon.d552541b.js";import{r as P,B as x,y as V,A as y,m as N,s as j,u as B,b as c,o as A,c as D,g as n,D as l,t as v,e as a,w as t,J as K,i as H,E as Y}from"./index.f54b11e4.js";import{r as E,u as g}from"./school.2999f601.js";import{u as Q}from"./user.c132af10.js";import{g as b}from"./ak.70a0bce5.js";const G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAAXNSR0IArs4c6QAAAXBJREFUKFN1kD9IAnEUx9/3zlMHKYeGtmizLXCMoECoodG2IEqrJdLSJXX4QWgNB6eQg3kRQYGgQVtLEE01FNRUWw21BREuddz9XpxlHFFvejw+3z88kGeE2AtqYScF4mUCCtbr06EQwu4iKBnmiAT6QTIGojEwHXxYtO8PKBkmOQlCi5kuVZaPKJbrbQWKzrZzbbW1UyHm3rtOQlRDWo82BShRAsVRKpsPuXRy0Fvnr93l/oVd10A4OLGeThy54n/hTnw4cEKMRn41Uf0TLpbNCwW8LBllArXyqWSlW+nbuX6XSy8MddR6LUI+9YxBW15Q6LU+v09tomTsNknFdm5l/twVCCF83t+6t2LFTCmSQxB6LeKqLNsZF9mll9+f+E5rWtweRSfeqMcZlGHpjxfWZp+7gs1KPcoSDSY5nV9dvOnA7mwYOzEFikHgFklcEXiKCMOwnblcduneZX7gr757Qa3XmQFogJhvrbfnY2//T8TCqQlkvmWrAAAAAElFTkSuQmCC",X=async o=>await E.post("https://api.ps.familyeducation.org.cn/v1/user/auth/phone",o),$=async o=>await E.post("https://api.ps.familyeducation.org.cn/v1/user/auth/send",o),J=async o=>await E.post("https://api.ps.familyeducation.org.cn/v1/school/admin/my_list",o),C=P(60),S=P(!1),q=async o=>{await $({phone:o})},z=async o=>{await q(o),S.value=!0;const r=setInterval(()=>{C.value--,C.value<=0&&(S.value=!1,C.value=0,clearTimeout(r))},1e3)};const Z={class:"container-wrap flex"},ee={class:"logo_section"},ne=["src"],ie={class:"school-name"},se={class:"logo_name_wrap"},oe=n("h1",{class:"title-char"},"Hi\uFF0C\u4F60\u597D\uFF01",-1),_e={class:"title-char"},ae={class:"flex-center login-container-wrap"},pe={class:"login-wrap"},re=n("h1",null,"\u767B\u5F55\u7BA1\u7406\u4E2D\u5FC3",-1),te={class:"flex item-wrap p"},me=n("div",{class:"icon-wrap flex-center"},[n("img",{class:"login-icon",src:M,alt:""})],-1),de={class:"flex item-wrap"},ce={class:"flex el-input-wrap"},le=n("div",{class:"icon-wrap flex-center"},[n("img",{class:"login-icon",src:G,alt:""})],-1),ge={key:0,class:"send-code grey"},Ce=H("\u767B\u5F55"),Se={__name:"loginView",setup(o){const r=x();console.log("query",r.query);const m=P({});V(async()=>{r.query.domain&&await g().reqSchoolDomainGetAPI(r.query.domain),g().schoolDomainInfo.id&&(m.value=g().schoolDomainInfo)});const R=P({}),k=(_,e,i)=>{e===""?i(new Error("\u8BF7\u8F93\u5165\u624B\u673A\u53F7")):/^1((3[0-9])|(4[1579])|(5[0-9])|(6[6])|(7[0-9])|(8[0-9])|(9[0-9]))\d{8}$/.test(e)?i():i(new Error("\u624B\u673A\u53F7\u683C\u5F0F\u4E0D\u6B63\u786E"))},h=(_,e,i)=>{e===""?i(new Error("\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801")):i()},s=y({codeRef:"",phoneRef:""}),u=N();j(()=>{u.loginInfo.phone&&(s.phoneRef=u.loginInfo.phone)});const F=y({phoneRef:[{validator:k,trigger:"blur"}],codeRef:[{validator:h,trigger:"blur"}]}),U=_=>{!_||_.validate(e=>{if(e)console.log("submit!",s),f();else return console.log("error submit!"),!1})},f=async()=>{const _={phone:s.phoneRef,code:s.codeRef},e=await X(_);u.getLoginInfo(e.token,e.uid,s.phoneRef),await w()},I=B(),w=async()=>{const e=await J({});O(e),!e||e.length<1?Y.error("\u65E0\u6743\u9650"):I.push({path:"/"})},O=_=>{const e=Q(),i=g();i.saveSchoolInfoList();const p=_[0].school_id;console.log("debug :>> ",p),i.saveSchoolInfo(p),e.saveSchoolUserInfo()};return(_,e)=>{const i=c("el-input"),p=c("el-form-item"),L=c("el-checkbox"),W=c("el-button"),T=c("el-form");return A(),D("div",{class:"root",style:K(`background-image: url(${m.value.bg_img||l(b)("login_bg.png")})`)},[n("div",Z,[n("div",ee,[n("img",{class:"logo-img",src:m.value.icon||l(b)("school_logo.png"),alt:""},null,8,ne),n("span",ie,v(m.value.name||"\u798F\u5EFA\u5E7F\u64AD\u7535\u89C6\u5927\u5B66"),1)]),n("div",se,[oe,n("h1",_e," \u6B22\u8FCE\u6765\u5230"+v(m.value.name||"\u798F\u5EFA\u5E7F\u64AD\u7535\u89C6\u5927\u5B66"),1)]),n("div",ae,[n("div",pe,[re,a(T,{ref_key:"ruleFormRef",ref:R,model:s,"status-icon":"",rules:F,"label-width":"120px",class:"demo-ruleForm","label-position":"top",style:{width:"314px"}},{default:t(()=>[a(p,{"label-width":0,prop:"phoneRef",style:{width:"314px"}},{default:t(()=>[n("div",te,[me,a(i,{modelValue:s.phoneRef,"onUpdate:modelValue":e[0]||(e[0]=d=>s.phoneRef=d),type:"text",maxlength:11,resize:"none",clearable:"",autocomplete:"off",class:"el-input"},null,8,["modelValue"])])]),_:1}),a(p,{"label-width":0,prop:"codeRef",style:{width:"314px"}},{default:t(()=>[n("div",de,[n("div",ce,[le,a(i,{resize:"none",class:"el-input code",maxlength:"6",modelValue:s.codeRef,"onUpdate:modelValue":e[1]||(e[1]=d=>s.codeRef=d),type:"codeRefword"},null,8,["modelValue"])]),l(S)?(A(),D("div",ge," \u5DF2\u53D1\u9001("+v(l(C))+"s) ",1)):(A(),D("div",{key:1,class:"send-code",onClick:e[2]||(e[2]=d=>l(z)(s.phoneRef))}," \u83B7\u53D6\u9A8C\u8BC1\u7801 "))])]),_:1}),a(p,null,{default:t(()=>[a(L,{label:"\u8BB0\u4F4F\u8D26\u53F7",name:"type"})]),_:1}),a(p,null,{default:t(()=>[a(W,{class:"login-btn",type:"primary",onClick:e[3]||(e[3]=d=>U(R.value))},{default:t(()=>[Ce]),_:1})]),_:1})]),_:1},8,["model","rules"])])])])],4)}}};export{Se as default};

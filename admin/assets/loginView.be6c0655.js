import{_ as V}from"./login-zh-icon.d552541b.js";import{b,H as F,z as M,U as P,m as O,v as H,u as X,r as m,o as y,c as f,h as n,B as g,t as k,a as o,w as l,P as q,i as G,E as W}from"./index.4f62021f.js";import{u as t}from"./school.a228afe4.js";import{u as B}from"./user.91849ee9.js";import{r as x}from"./request.b885c166.js";import{g as A}from"./ak.02252990.js";const Y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAAXNSR0IArs4c6QAAAXBJREFUKFN1kD9IAnEUx9/3zlMHKYeGtmizLXCMoECoodG2IEqrJdLSJXX4QWgNB6eQg3kRQYGgQVtLEE01FNRUWw21BREuddz9XpxlHFFvejw+3z88kGeE2AtqYScF4mUCCtbr06EQwu4iKBnmiAT6QTIGojEwHXxYtO8PKBkmOQlCi5kuVZaPKJbrbQWKzrZzbbW1UyHm3rtOQlRDWo82BShRAsVRKpsPuXRy0Fvnr93l/oVd10A4OLGeThy54n/hTnw4cEKMRn41Uf0TLpbNCwW8LBllArXyqWSlW+nbuX6XSy8MddR6LUI+9YxBW15Q6LU+v09tomTsNknFdm5l/twVCCF83t+6t2LFTCmSQxB6LeKqLNsZF9mll9+f+E5rWtweRSfeqMcZlGHpjxfWZp+7gs1KPcoSDSY5nV9dvOnA7mwYOzEFikHgFklcEXiKCMOwnblcduneZX7gr757Qa3XmQFogJhvrbfnY2//T8TCqQlkvmWrAAAAAElFTkSuQmCC",z=async i=>await x.post("https://api.ps.familyeducation.org.cn/v1/user/auth/phone",i),K=async i=>await x.post("https://api.ps.familyeducation.org.cn/v1/user/auth/send",i),Q=async i=>await x.post("https://api.ps.familyeducation.org.cn/v1/school/admin/my_list",i),u=b(60),h=b(!1),$=async i=>{await K({phone:i})},Z=async i=>{await $(i),h.value=!0;const c=setInterval(()=>{u.value--,u.value<=0&&(h.value=!1,u.value=0,clearTimeout(c))},1e3)};const J={class:"container-wrap flex"},ee={class:"logo_section"},ne=["src"],_e={class:"school-name"},se={class:"logo_name_wrap"},ie=n("h1",{class:"title-char"},"Hi\uFF0C\u4F60\u597D\uFF01",-1),pe={class:"title-char"},oe={class:"flex-center login-container-wrap"},ce={class:"login-wrap"},ae=n("h1",null,"\u767B\u5F55\u5B66\u6821\u7BA1\u7406\u4E2D\u5FC3",-1),te={class:"flex item-wrap p"},re=n("div",{class:"icon-wrap flex-center"},[n("img",{class:"login-icon",src:V,alt:""})],-1),le={class:"flex item-wrap"},de={class:"flex el-input-wrap"},me=n("div",{class:"icon-wrap flex-center"},[n("img",{class:"login-icon",src:Y,alt:""})],-1),ge={key:0,class:"send-code grey"},ue=G("\u767B\u5F55"),xe={__name:"loginView",setup(i){const c=F();console.log("query",c.query);const r=b({});M(async()=>{c.query.domain?await t().reqSchoolDomainGetAPI(c.query.domain):c.query.id&&await t().saveSchoolInfo(c.query.id),t().schoolDomainInfo.id?r.value=t().schoolDomainInfo:t().schoolInfo.id&&(r.value=t().schoolInfo)});const E=b({}),D=(p,e,_)=>{e===""?_(new Error("\u8BF7\u8F93\u5165\u624B\u673A\u53F7")):/^1((3[0-9])|(4[1579])|(5[0-9])|(6[6])|(7[0-9])|(8[0-9])|(9[0-9]))\d{8}$/.test(e)?_():_(new Error("\u624B\u673A\u53F7\u683C\u5F0F\u4E0D\u6B63\u786E"))},U=(p,e,_)=>{e===""?_(new Error("\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801")):_()},s=P({codeRef:"",phoneRef:""}),v=O();H(()=>{v.loginInfo.phone&&(s.phoneRef=v.loginInfo.phone)});const C=P({phoneRef:[{validator:D,trigger:"blur"}],codeRef:[{validator:U,trigger:"blur"}]}),w=p=>{!p||p.validate(e=>{if(e)console.log("submit!",s),R();else return console.log("error submit!"),!1})},R=async()=>{const p={phone:s.phoneRef,code:s.codeRef},e=await z(p);v.getLoginInfo(e.token,e.uid,s.phoneRef),await T()},I=X(),T=async()=>{const e=await Q({});!e||e.length<1?W.error("\u65E0\u6743\u9650"):(S(e),I.push({path:"/platformSelection"}))},S=p=>{const e=B(),_=t();_.saveSchoolInfoList();const a=p[0].school_id;console.log("debug :>> ",a),_.saveSchoolInfo(a),e.saveSchoolUserInfo()};return(p,e)=>{const _=m("el-input"),a=m("el-form-item"),j=m("el-checkbox"),L=m("el-button"),N=m("el-form");return y(),f("div",{class:"root",style:q(`background-image: url(${r.value.bg_img||g(A)("login_bg.png")})`)},[n("div",J,[n("div",ee,[n("img",{class:"logo-img",src:r.value.icon||g(A)("school_logo.png"),alt:""},null,8,ne),n("span",_e,k(r.value.name||"\u798F\u5EFA\u5F00\u653E\u5927\u5B66"),1)]),n("div",se,[ie,n("h1",pe," \u6B22\u8FCE\u6765\u5230"+k(r.value.name||"\u798F\u5EFA\u5F00\u653E\u5927\u5B66"),1)]),n("div",oe,[n("div",ce,[ae,o(N,{ref_key:"ruleFormRef",ref:E,model:s,"status-icon":"",rules:C,"label-width":"120px",class:"demo-ruleForm","label-position":"top",style:{width:"314px"}},{default:l(()=>[o(a,{"label-width":0,prop:"phoneRef",style:{width:"314px"}},{default:l(()=>[n("div",te,[re,o(_,{modelValue:s.phoneRef,"onUpdate:modelValue":e[0]||(e[0]=d=>s.phoneRef=d),type:"text",maxlength:11,resize:"none",clearable:"",autocomplete:"off",class:"el-input"},null,8,["modelValue"])])]),_:1}),o(a,{"label-width":0,prop:"codeRef",style:{width:"314px"}},{default:l(()=>[n("div",le,[n("div",de,[me,o(_,{resize:"none",class:"el-input code",maxlength:"6",modelValue:s.codeRef,"onUpdate:modelValue":e[1]||(e[1]=d=>s.codeRef=d),type:"codeRefword"},null,8,["modelValue"])]),g(h)?(y(),f("div",ge," \u5DF2\u53D1\u9001("+k(g(u))+"s) ",1)):(y(),f("div",{key:1,class:"send-code",onClick:e[2]||(e[2]=d=>g(Z)(s.phoneRef))}," \u83B7\u53D6\u9A8C\u8BC1\u7801 "))])]),_:1}),o(a,null,{default:l(()=>[o(j,{label:"\u8BB0\u4F4F\u8D26\u53F7",name:"type"})]),_:1}),o(a,null,{default:l(()=>[o(L,{class:"login-btn",type:"primary",onClick:e[3]||(e[3]=d=>w(E.value))},{default:l(()=>[ue]),_:1})]),_:1})]),_:1},8,["model","rules"])])])])],4)}}};export{xe as default};

import{_ as G}from"./login-zh-icon.d552541b.js";import{r as P,H as W,z as N,U as b,m as x,v as V,u as H,b as c,o as S,c as u,h as i,B as g,t as F,e as r,w as l,P as Y,i as K,E as j}from"./index.47abfc20.js";import{r as D,u as p}from"./school.6822d12c.js";import{u as B}from"./user.62dc28f1.js";import{g as I}from"./ak.b86dff92.js";const X="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAAXNSR0IArs4c6QAAAXBJREFUKFN1kD9IAnEUx9/3zlMHKYeGtmizLXCMoECoodG2IEqrJdLSJXX4QWgNB6eQg3kRQYGgQVtLEE01FNRUWw21BREuddz9XpxlHFFvejw+3z88kGeE2AtqYScF4mUCCtbr06EQwu4iKBnmiAT6QTIGojEwHXxYtO8PKBkmOQlCi5kuVZaPKJbrbQWKzrZzbbW1UyHm3rtOQlRDWo82BShRAsVRKpsPuXRy0Fvnr93l/oVd10A4OLGeThy54n/hTnw4cEKMRn41Uf0TLpbNCwW8LBllArXyqWSlW+nbuX6XSy8MddR6LUI+9YxBW15Q6LU+v09tomTsNknFdm5l/twVCCF83t+6t2LFTCmSQxB6LeKqLNsZF9mll9+f+E5rWtweRSfeqMcZlGHpjxfWZp+7gs1KPcoSDSY5nV9dvOnA7mwYOzEFikHgFklcEXiKCMOwnblcduneZX7gr757Qa3XmQFogJhvrbfnY2//T8TCqQlkvmWrAAAAAElFTkSuQmCC",Q=async o=>await D.post("https://api.ps.familyeducation.org.cn/v1/user/auth/phone",o),z=async o=>await D.post("https://api.ps.familyeducation.org.cn/v1/user/auth/send",o),$=async o=>await D.post("https://api.ps.familyeducation.org.cn/v1/school/admin/my_list",o),C=P(60),E=P(!1),q=async o=>{await z({phone:o})},J=async o=>{await q(o),E.value=!0;const _=setInterval(()=>{C.value--,C.value<=0&&(E.value=!1,C.value=0,clearTimeout(_))},1e3)};const Z={class:"container-wrap flex"},ee={class:"logo_section"},ie=["src"],ne={class:"school-name"},se={class:"logo_name_wrap"},oe=i("h1",{class:"title-char"},"Hi\uFF0C\u4F60\u597D\uFF01",-1),ae={class:"title-char"},re={class:"flex-center login-container-wrap"},_e={class:"login-wrap"},me=i("h1",null,"\u767B\u5F55\u7BA1\u7406\u4E2D\u5FC3",-1),pe={class:"flex item-wrap p"},te=i("div",{class:"icon-wrap flex-center"},[i("img",{class:"login-icon",src:G,alt:""})],-1),le={class:"flex item-wrap"},de={class:"flex el-input-wrap"},ce=i("div",{class:"icon-wrap flex-center"},[i("img",{class:"login-icon",src:X,alt:""})],-1),ge={key:0,class:"send-code grey"},Ce=K("\u767B\u5F55"),Ee={__name:"loginView",setup(o){const _=W();console.log("query",_.query);const t=P({});N(async()=>{_.query.domain?await p().reqSchoolDomainGetAPI(_.query.domain):_.query.id&&await p().saveSchoolInfo(_.query.id),p().schoolDomainInfo.id?t.value=p().schoolDomainInfo:p().schoolInfo.id&&(t.value=p().schoolInfo)});const R=P({}),v=(a,e,n)=>{e===""?n(new Error("\u8BF7\u8F93\u5165\u624B\u673A\u53F7")):/^1((3[0-9])|(4[1579])|(5[0-9])|(6[6])|(7[0-9])|(8[0-9])|(9[0-9]))\d{8}$/.test(e)?n():n(new Error("\u624B\u673A\u53F7\u683C\u5F0F\u4E0D\u6B63\u786E"))},h=(a,e,n)=>{e===""?n(new Error("\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801")):n()},s=b({codeRef:"",phoneRef:""}),A=x();V(()=>{A.loginInfo.phone&&(s.phoneRef=A.loginInfo.phone)});const w=b({phoneRef:[{validator:v,trigger:"blur"}],codeRef:[{validator:h,trigger:"blur"}]}),O=a=>{!a||a.validate(e=>{if(e)console.log("submit!",s),T();else return console.log("error submit!"),!1})},T=async()=>{const a={phone:s.phoneRef,code:s.codeRef},e=await Q(a);A.getLoginInfo(e.token,e.uid,s.phoneRef),await y()},M=H(),y=async()=>{const e=await $({});!e||e.length<1?j.error("\u65E0\u6743\u9650"):(L(e),M.push({path:"/platformSelection"}))},L=a=>{const e=B(),n=p();n.saveSchoolInfoList();const m=a[0].school_id;console.log("debug :>> ",m),n.saveSchoolInfo(m),e.saveSchoolUserInfo()};return(a,e)=>{const n=c("el-input"),m=c("el-form-item"),U=c("el-checkbox"),k=c("el-button"),f=c("el-form");return S(),u("div",{class:"root",style:Y(`background-image: url(${t.value.bg_img||g(I)("login_bg.png")})`)},[i("div",Z,[i("div",ee,[i("img",{class:"logo-img",src:t.value.icon||g(I)("school_logo.png"),alt:""},null,8,ie),i("span",ne,F(t.value.name||"\u798F\u5EFA\u5F00\u653E\u5927\u5B66"),1)]),i("div",se,[oe,i("h1",ae," \u6B22\u8FCE\u6765\u5230"+F(t.value.name||"\u798F\u5EFA\u5F00\u653E\u5927\u5B66"),1)]),i("div",re,[i("div",_e,[me,r(f,{ref_key:"ruleFormRef",ref:R,model:s,"status-icon":"",rules:w,"label-width":"120px",class:"demo-ruleForm","label-position":"top",style:{width:"314px"}},{default:l(()=>[r(m,{"label-width":0,prop:"phoneRef",style:{width:"314px"}},{default:l(()=>[i("div",pe,[te,r(n,{modelValue:s.phoneRef,"onUpdate:modelValue":e[0]||(e[0]=d=>s.phoneRef=d),type:"text",maxlength:11,resize:"none",clearable:"",autocomplete:"off",class:"el-input"},null,8,["modelValue"])])]),_:1}),r(m,{"label-width":0,prop:"codeRef",style:{width:"314px"}},{default:l(()=>[i("div",le,[i("div",de,[ce,r(n,{resize:"none",class:"el-input code",maxlength:"6",modelValue:s.codeRef,"onUpdate:modelValue":e[1]||(e[1]=d=>s.codeRef=d),type:"codeRefword"},null,8,["modelValue"])]),g(E)?(S(),u("div",ge," \u5DF2\u53D1\u9001("+F(g(C))+"s) ",1)):(S(),u("div",{key:1,class:"send-code",onClick:e[2]||(e[2]=d=>g(J)(s.phoneRef))}," \u83B7\u53D6\u9A8C\u8BC1\u7801 "))])]),_:1}),r(m,null,{default:l(()=>[r(U,{label:"\u8BB0\u4F4F\u8D26\u53F7",name:"type"})]),_:1}),r(m,null,{default:l(()=>[r(k,{class:"login-btn",type:"primary",onClick:e[3]||(e[3]=d=>O(R.value))},{default:l(()=>[Ce]),_:1})]),_:1})]),_:1},8,["model","rules"])])])])],4)}}};export{Ee as default};

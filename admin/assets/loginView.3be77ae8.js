import{_ as w}from"./login-zh-icon.d552541b.js";import{b as E,H as y,z as B,U as u,m as J,v as G,u as W,r as P,o as C,c as D,h as e,B as S,t as g,a,w as d,P as x,i as H,E as k}from"./index.b8cfcbe6.js";import{u as m}from"./school.9aee2f29.js";import{u as z}from"./user.7a80b3bb.js";import{r as R}from"./request.034e6227.js";import{g as v}from"./ak.28e5d0de.js";const X="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAAXNSR0IArs4c6QAAAXBJREFUKFN1kD9IAnEUx9/3zlMHKYeGtmizLXCMoECoodG2IEqrJdLSJXX4QWgNB6eQg3kRQYGgQVtLEE01FNRUWw21BREuddz9XpxlHFFvejw+3z88kGeE2AtqYScF4mUCCtbr06EQwu4iKBnmiAT6QTIGojEwHXxYtO8PKBkmOQlCi5kuVZaPKJbrbQWKzrZzbbW1UyHm3rtOQlRDWo82BShRAsVRKpsPuXRy0Fvnr93l/oVd10A4OLGeThy54n/hTnw4cEKMRn41Uf0TLpbNCwW8LBllArXyqWSlW+nbuX6XSy8MddR6LUI+9YxBW15Q6LU+v09tomTsNknFdm5l/twVCCF83t+6t2LFTCmSQxB6LeKqLNsZF9mll9+f+E5rWtweRSfeqMcZlGHpjxfWZp+7gs1KPcoSDSY5nV9dvOnA7mwYOzEFikHgFklcEXiKCMOwnblcduneZX7gr757Qa3XmQFogJhvrbfnY2//T8TCqQlkvmWrAAAAAElFTkSuQmCC",K=async i=>await R.post("https://api.ps.familyeducation.org.cn/v1/user/auth/phone",i),Z=async i=>await R.post("https://api.ps.familyeducation.org.cn/v1/user/auth/send",i),Y=async i=>await R.post("https://api.ps.familyeducation.org.cn/v1/school/admin/my_list",i),c=E(60),A=E(!1),Q=async i=>{await Z({phone:i})},$=async i=>{await Q(i),A.value=!0;const t=setInterval(()=>{c.value--,c.value<=0&&(A.value=!1,c.value=0,clearTimeout(t))},1e3)};const q={class:"container-wrap flex"},oo={class:"logo_section"},eo=["src"],no={class:"school-name"},so={class:"logo_name_wrap"},io=e("h1",{class:"title-char"},"Hi\uFF0C\u4F60\u597D\uFF01",-1),ro={class:"title-char"},ao={class:"flex-center login-container-wrap"},to={class:"login-wrap"},_o=e("h1",null,"\u767B\u5F55\u5B66\u6821\u7BA1\u7406\u4E2D\u5FC3",-1),mo={class:"flex item-wrap p"},po=e("div",{class:"icon-wrap flex-center"},[e("img",{class:"login-icon",src:w,alt:""})],-1),lo={class:"flex item-wrap"},Po={class:"flex el-input-wrap"},So=e("div",{class:"icon-wrap flex-center"},[e("img",{class:"login-icon",src:X,alt:""})],-1),co={key:0,class:"send-code grey"},Eo=H("\u767B\u5F55"),Io={__name:"loginView",setup(i){const t=y();console.log("query",t.query);const p=E({});B(async()=>{t.query.domain?await m().reqSchoolDomainGetAPI(t.query.domain):t.query.id&&await m().saveSchoolInfo(t.query.id),m().schoolDomainInfo.id?p.value=m().schoolDomainInfo:m().schoolInfo.id&&(p.value=m().schoolInfo)});const I=E({}),N=(r,o,n)=>{o===""?n(new Error("\u8BF7\u8F93\u5165\u624B\u673A\u53F7")):/^1((3[0-9])|(4[1579])|(5[0-9])|(6[6])|(7[0-9])|(8[0-9])|(9[0-9]))\d{8}$/.test(o)?n():n(new Error("\u624B\u673A\u53F7\u683C\u5F0F\u4E0D\u6B63\u786E"))},T=(r,o,n)=>{o===""?n(new Error("\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801")):n()},s=u({codeRef:"",phoneRef:""}),O=J();G(()=>{O.loginInfo.phone&&(s.phoneRef=O.loginInfo.phone)});const M=u({phoneRef:[{validator:N,trigger:"blur"}],codeRef:[{validator:T,trigger:"blur"}]}),b=r=>{!r||r.validate(o=>{if(o)console.log("submit!",s),f();else return console.log("error submit!"),!1})},f=async()=>{const r={phone:s.phoneRef,code:s.codeRef},o=await K(r);O.getLoginInfo(o.token,o.uid,s.phoneRef),await V()},h=W(),V=async()=>{const o=await Y({});!o||o.length<1?k.error("\u65E0\u6743\u9650"):(F(o),h.push({path:"/platformSelection"}))},F=r=>{const o=z(),n=m();n.saveSchoolInfoList();const _=r[0].school_id;console.log("debug :>> ",_),n.saveSchoolInfo(_),o.saveSchoolUserInfo()};return(r,o)=>{const n=P("el-input"),_=P("el-form-item"),U=P("el-checkbox"),L=P("el-button"),j=P("el-form");return C(),D("div",{class:"root",style:x(`background-image: url(${p.value.bg_img||S(v)("login_bg.png")})`)},[e("div",q,[e("div",oo,[e("img",{class:"logo-img",src:p.value.icon||S(v)("school_logo.png"),alt:""},null,8,eo),e("span",no,g(p.value.name||"\u798F\u5EFA\u5F00\u653E\u5927\u5B66"),1)]),e("div",so,[io,e("h1",ro," \u6B22\u8FCE\u6765\u5230"+g(p.value.name||"\u798F\u5EFA\u5F00\u653E\u5927\u5B66"),1)]),e("div",ao,[e("div",to,[_o,a(j,{ref_key:"ruleFormRef",ref:I,model:s,"status-icon":"",rules:M,"label-width":"120px",class:"demo-ruleForm","label-position":"top",style:{width:"314px"}},{default:d(()=>[a(_,{"label-width":0,prop:"phoneRef",style:{width:"314px"}},{default:d(()=>[e("div",mo,[po,a(n,{modelValue:s.phoneRef,"onUpdate:modelValue":o[0]||(o[0]=l=>s.phoneRef=l),type:"text",maxlength:11,resize:"none",clearable:"",autocomplete:"off",class:"el-input"},null,8,["modelValue"])])]),_:1}),a(_,{"label-width":0,prop:"codeRef",style:{width:"314px"}},{default:d(()=>[e("div",lo,[e("div",Po,[So,a(n,{resize:"none",class:"el-input code",maxlength:"6",modelValue:s.codeRef,"onUpdate:modelValue":o[1]||(o[1]=l=>s.codeRef=l),type:"codeRefword"},null,8,["modelValue"])]),S(A)?(C(),D("div",co," \u5DF2\u53D1\u9001("+g(S(c))+"s) ",1)):(C(),D("div",{key:1,class:"send-code",onClick:o[2]||(o[2]=l=>S($)(s.phoneRef))}," \u83B7\u53D6\u9A8C\u8BC1\u7801 "))])]),_:1}),a(_,null,{default:d(()=>[a(U,{label:"\u8BB0\u4F4F\u8D26\u53F7",name:"type"})]),_:1}),a(_,null,{default:d(()=>[a(L,{class:"login-btn",type:"primary",onClick:o[3]||(o[3]=l=>b(I.value))},{default:d(()=>[Eo]),_:1})]),_:1})]),_:1},8,["model","rules"])])])])],4)}}};export{Io as default};

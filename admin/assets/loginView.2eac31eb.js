import{_ as I}from"./login-zh-icon.d552541b.js";import{r as A,A as v,n as O,p as w,u as L,b as m,o as g,c as C,h as i,e as _,w as r,D as P,t as W,i as T,E as M}from"./index.d9354779.js";import{r as D}from"./request.fc4b7f65.js";const x="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAAXNSR0IArs4c6QAAAXBJREFUKFN1kD9IAnEUx9/3zlMHKYeGtmizLXCMoECoodG2IEqrJdLSJXX4QWgNB6eQg3kRQYGgQVtLEE01FNRUWw21BREuddz9XpxlHFFvejw+3z88kGeE2AtqYScF4mUCCtbr06EQwu4iKBnmiAT6QTIGojEwHXxYtO8PKBkmOQlCi5kuVZaPKJbrbQWKzrZzbbW1UyHm3rtOQlRDWo82BShRAsVRKpsPuXRy0Fvnr93l/oVd10A4OLGeThy54n/hTnw4cEKMRn41Uf0TLpbNCwW8LBllArXyqWSlW+nbuX6XSy8MddR6LUI+9YxBW15Q6LU+v09tomTsNknFdm5l/twVCCF83t+6t2LFTCmSQxB6LeKqLNsZF9mll9+f+E5rWtweRSfeqMcZlGHpjxfWZp+7gs1KPcoSDSY5nV9dvOnA7mwYOzEFikHgFklcEXiKCMOwnblcduneZX7gr757Qa3XmQFogJhvrbfnY2//T8TCqQlkvmWrAAAAAElFTkSuQmCC",V="/assets/login_bg.3e86301f.png",N=async s=>await D.post("http://api.ps.familyeducation.org.cn/v1/user/auth/phone",s),j=async s=>await D.post("http://api.ps.familyeducation.org.cn/v1/user/auth/send",s),B=async s=>await D.post("http://api.ps.familyeducation.org.cn/v1/school/admin/my_list",s),c=A(60),u=A(!1),K=async s=>{await j({phone:s})},H=async s=>{await K(s),u.value=!0;const p=setInterval(()=>{c.value--,c.value<=0&&(u.value=!1,c.value=0,clearTimeout(p))},1e3)};const Y={class:"root flex"},Q={class:"login-wrap"},G=i("h1",null,"\u767B\u5F55\u7BA1\u7406\u4E2D\u5FC3",-1),X={class:"flex item-wrap p"},$=i("div",{class:"icon-wrap flex-center"},[i("img",{class:"login-icon",src:I,alt:""})],-1),J={class:"flex item-wrap"},z={class:"flex el-input-wrap"},q=i("div",{class:"icon-wrap flex-center"},[i("img",{class:"login-icon",src:x,alt:""})],-1),Z={key:0,class:"send-code grey"},ee=T("\u767B\u5F55"),ne=i("img",{src:V,class:"bg-container"},null,-1),_e={__name:"loginView",setup(s){const p=A({}),S=(a,e,o)=>{if(e==="")o(new Error("\u8BF7\u8F93\u5165\u624B\u673A\u53F7"));else if(!/^1((3[0-9])|(4[1579])|(5[0-9])|(6[6])|(7[0-9])|(8[0-9])|(9[0-9]))\d{8}$/.test(e))o(new Error("\u624B\u673A\u53F7\u683C\u5F0F\u4E0D\u6B63\u786E"));else{if(n.phoneRef!==""){if(!p.value)return;p.value.validateField("phoneRef",()=>null)}o()}},E=(a,e,o)=>{e===""?o(new Error("\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801")):o()},n=v({codeRef:"",phoneRef:""}),l=O();w(()=>{l.loginInfo.phone&&(n.phoneRef=l.loginInfo.phone)});const R=v({phoneRef:[{validator:S,trigger:"blur"}],codeRef:[{validator:E,trigger:"blur"}]}),y=a=>{!a||a.validate(e=>{if(e)console.log("submit!",n),b();else return console.log("error submit!"),!1})},b=async()=>{const a={phone:n.phoneRef,code:n.codeRef},e=await N(a);l.getLoginInfo(e.token,e.uid,n.phoneRef),await F()},k=L(),F=async()=>{const e=await B({});!e||e.length<1?M.error("\u65E0\u6743\u9650"):k.push({path:"/"})};return(a,e)=>{const o=m("el-input"),d=m("el-form-item"),h=m("el-checkbox"),U=m("el-button"),f=m("el-form");return g(),C("div",Y,[i("div",null,[i("div",Q,[G,_(f,{ref_key:"ruleFormRef",ref:p,model:n,"status-icon":"",rules:R,"label-width":"120px",class:"demo-ruleForm","label-position":"top"},{default:r(()=>[_(d,{"label-width":0,prop:"phoneRef"},{default:r(()=>[i("div",X,[$,_(o,{modelValue:n.phoneRef,"onUpdate:modelValue":e[0]||(e[0]=t=>n.phoneRef=t),type:"text",maxlength:11,clearable:"",autocomplete:"off",class:"el-input"},null,8,["modelValue"])])]),_:1}),_(d,{"label-width":0,prop:"codeRef"},{default:r(()=>[i("div",J,[i("div",z,[q,_(o,{class:"flex1",maxlength:"6",modelValue:n.codeRef,"onUpdate:modelValue":e[1]||(e[1]=t=>n.codeRef=t),type:"codeRefword"},null,8,["modelValue"])]),P(u)?(g(),C("div",Z," \u5DF2\u53D1\u9001("+W(P(c))+"s) ",1)):(g(),C("div",{key:1,class:"send-code",onClick:e[2]||(e[2]=t=>P(H)(n.phoneRef))}," \u83B7\u53D6\u9A8C\u8BC1\u7801 "))])]),_:1}),_(d,null,{default:r(()=>[_(h,{label:"\u8BB0\u4F4F\u8D26\u53F7",name:"type"})]),_:1}),_(d,null,{default:r(()=>[_(U,{class:"login-btn",type:"primary",onClick:e[3]||(e[3]=t=>y(p.value))},{default:r(()=>[ee]),_:1})]),_:1})]),_:1},8,["model","rules"])])]),ne])}}};export{_e as default};
